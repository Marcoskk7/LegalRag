"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[519],{82194:function(Je,_,o){o.r(_),o.d(_,{default:function(){return Ne}});var oe=o(90228),f=o.n(oe),fe=o(87999),x=o.n(fe),he=o(48305),p=o.n(he),ve=o(86980),N=o(43953),E=o(31707),ee=o(58979),J=o(74139),me=o(45011),ge=o(95273),pe=o(21307),se=o(13167),F=o(86978),je=o(26280),v=o(75271),e=o(52676),A="http://api.legalrag.studio",xe=function($,D){var k,m=[],z=[],T=[],B=(k=D!=null?D:$.raw_content)!==null&&k!==void 0?k:"";return $.risks.forEach(function(d){var K="risk-".concat(d.identifier),C=d.detected_issue,R=C.match(/^(.{0,25})/),b=R?R[1]+(C.length>25?"...":""):"\u98CE\u9669\u63D0\u793A",H=d.legal_basis.map(function(g,S){return{id:"legal-".concat(d.identifier,"-").concat(S),lawName:g.law_name,article:g.order,content:g.content,score:g.relevance_score,explanation:void 0,relatedRange:d.highlight_range}});H.forEach(function(g){z.find(function(S){return S.lawName===g.lawName&&S.article===g.article})||z.push(g)});var I={id:K,identifier:d.identifier,level:d.level,title:b,content:d.detected_issue,suggestion:d.suggestions,highlightRange:d.highlight_range,legalBasis:H};if(m.push(I),d.suggestions){var c="";if(B&&d.highlight_range){var L=d.highlight_range,G=L.start,Z=L.end;G>=0&&Z<=B.length&&(c=B.substring(G,Z))}c?c.length>100&&(c=c.substring(0,100)+"..."):c=C.substring(0,50)+(C.length>50?"...":""),T.push({id:"sug-".concat(d.identifier),original:c,revised:d.suggestions,reason:"\u9488\u5BF9\u98CE\u9669\uFF1A".concat(b),highlightRange:d.highlight_range})}}),{contractText:B||void 0,risks:m,suggestions:T,legalBasis:z}},ye=function(){var $=(0,N.useSearchParams)(),D=p()($,1),k=D[0],m=k.get("fileId"),z=(0,v.useState)(!0),T=p()(z,2),B=T[0],d=T[1],K=(0,v.useState)("init"),C=p()(K,2),R=C[0],b=C[1],H=(0,v.useState)(null),I=p()(H,2),c=I[0],L=I[1],G=(0,v.useState)(""),Z=p()(G,2),g=Z[0],S=Z[1],Ce=(0,v.useState)(""),re=p()(Ce,2),be=re[0],W=re[1],we=(0,v.useState)(!1),ne=p()(we,2),Be=ne[0],V=ne[1],Se=(0,v.useState)(null),ae=p()(Se,2),O=ae[0],Q=ae[1],Fe=(0,v.useState)("risk"),te=p()(Fe,2),P=te[0],X=te[1],Ae=(0,v.useState)(null),ie=p()(Ae,2),j=ie[0],le=ie[1],De=(0,v.useRef)(null),M=(0,v.useRef)(null),ke=function(){var i=x()(f()().mark(function r(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,(0,N.request)("".concat(A,"/api/v1/documents/").concat(m,"/risks/status"),{method:"GET"});case 3:return s.abrupt("return",s.sent);case 6:return s.prev=6,s.t0=s.catch(0),console.error("Fetch status error:",s.t0),s.abrupt("return",null);case 10:case"end":return s.stop()}},r,null,[[0,6]])}));return function(){return i.apply(this,arguments)}}(),ze=function(){var i=x()(f()().mark(function r(){var n;return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,N.request)("".concat(A,"/api/v1/documents/").concat(m,"/content"),{method:"GET"});case 3:return n=a.sent,n!=null&&n.raw_content&&S(n.raw_content),a.abrupt("return",n);case 8:return a.prev=8,a.t0=a.catch(0),console.error("Fetch document content error:",a.t0),a.abrupt("return",null);case 12:case"end":return a.stop()}},r,null,[[0,8]])}));return function(){return i.apply(this,arguments)}}(),Te=function(){var i=x()(f()().mark(function r(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,(0,N.request)("".concat(A,"/api/v1/documents/").concat(m,"/risks"),{method:"GET"});case 3:return s.abrupt("return",s.sent);case 6:return s.prev=6,s.t0=s.catch(0),console.error("Fetch risks error:",s.t0),s.abrupt("return",null);case 10:case"end":return s.stop()}},r,null,[[0,6]])}));return function(){return i.apply(this,arguments)}}(),ue=function(){var i=x()(f()().mark(function r(n){var s;return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(m){t.next=2;break}return t.abrupt("return",null);case 2:return t.prev=2,t.next=5,(0,N.request)("".concat(A,"/api/v1/documents/").concat(m,"/risks/").concat(n),{method:"GET"});case 5:return s=t.sent,t.abrupt("return",s);case 9:return t.prev=9,t.t0=t.catch(2),console.error("Fetch risk detail error:",t.t0),E.ZP.error("\u83B7\u53D6\u98CE\u9669\u8BE6\u60C5\u5931\u8D25"),t.abrupt("return",null);case 14:case"end":return t.stop()}},r,null,[[2,9]])}));return function(n){return i.apply(this,arguments)}}(),ce=function(){var i=x()(f()().mark(function r(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,(0,N.request)("".concat(A,"/api/v1/documents/").concat(m,"/risks/analyze"),{method:"POST",data:{top_k:1}});case 3:return s.abrupt("return",s.sent);case 6:return s.prev=6,s.t0=s.catch(0),console.error("Trigger analysis error:",s.t0),s.abrupt("return",null);case 10:case"end":return s.stop()}},r,null,[[0,6]])}));return function(){return i.apply(this,arguments)}}(),Re=function(){var i=x()(f()().mark(function r(){var n,s,a,t,u,h,l,w,U,Y,q;return f()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,Promise.all([ze(),Te()]);case 2:if(n=y.sent,s=p()(n,2),a=s[0],t=s[1],!(t&&t.status==="success")){y.next=17;break}if(h=xe(t,(u=a==null?void 0:a.raw_content)!==null&&u!==void 0?u:g),L(h),!(t.risks&&t.risks.length>0)){y.next=15;break}return w=(l=t.risks.find(function(Ue){return Ue.identifier==="0"}))!==null&&l!==void 0?l:t.risks[0],y.next=13,ue(w.identifier);case 13:U=y.sent,U&&(le(U),Y="risk-".concat(w.identifier),W(Y),q=document.getElementById(Y),q&&q.scrollIntoView({behavior:"smooth",block:"center"}));case 15:y.next=18;break;case 17:E.ZP.error("\u83B7\u53D6\u5206\u6790\u7ED3\u679C\u5931\u8D25");case 18:d(!1);case 19:case"end":return y.stop()}},r)}));return function(){return i.apply(this,arguments)}}(),Ze=function i(){M.current&&clearTimeout(M.current),M.current=setTimeout(x()(f()().mark(function r(){var n;return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,ke();case 2:if(n=a.sent,n){a.next=6;break}return i(),a.abrupt("return");case 6:if(n.status!=="success"){a.next=13;break}return b("success"),E.ZP.success("\u5206\u6790\u5B8C\u6210\uFF01"),a.next=11,Re();case 11:a.next=14;break;case 13:n.status==="failed"?(b("failed"),d(!1),E.ZP.error(n.error||"\u5206\u6790\u5931\u8D25")):i();case 14:case"end":return a.stop()}},r)})),2e3)},de=function(){var i=x()(f()().mark(function r(){var n;return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b("analyzing"),a.next=3,ce();case 3:if(n=a.sent,n){a.next=11;break}return console.log("First analysis trigger failed, retrying in 1s..."),a.next=8,new Promise(function(t){setTimeout(t,1e3)});case 8:return a.next=10,ce();case 10:n=a.sent;case 11:n&&n.status==="analyzing"?(E.ZP.info("\u5F00\u59CB\u667A\u80FD\u5206\u6790..."),Ze()):(b("failed"),d(!1),E.ZP.error("\u89E6\u53D1\u5206\u6790\u5931\u8D25\uFF0C\u53EF\u80FD\u662F\u6587\u6863\u5C1A\u672A\u51C6\u5907\u597D\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5"));case 12:case"end":return a.stop()}},r)}));return function(){return i.apply(this,arguments)}}(),Pe=function(){var i=x()(f()().mark(function r(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return d(!0),s.next=3,de();case 3:case"end":return s.stop()}},r)}));return function(){return i.apply(this,arguments)}}();(0,v.useEffect)(function(){if(!m){E.ZP.error("\u7F3A\u5C11\u6587\u4EF6ID\uFF0C\u8BF7\u91CD\u65B0\u4E0A\u4F20"),N.history.push("/");return}return Pe(),function(){M.current&&clearTimeout(M.current)}},[m]);var Me=function(){var i=x()(f()().mark(function r(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(m){s.next=2;break}return s.abrupt("return");case 2:return d(!0),s.next=5,de();case 5:case"end":return s.stop()}},r)}));return function(){return i.apply(this,arguments)}}(),$e=function(){N.history.push("/")},He=function(r){X("risk"),Q(r),V(!0)},Ie=function(r){X("suggestion"),Q(r),V(!0)},Le=function(r){X("legal"),Q(r),V(!0)},Ge=function(r,n){if(r==="risk"){var s=c==null?void 0:c.risks.find(function(u){return u.id===n});s&&(W(n),ue(s.identifier).then(function(u){u&&le(u)}),He(s))}else if(r==="suggestion"){W(n);var a=c==null?void 0:c.suggestions.find(function(u){return u.id===n});a&&Ie(a)}else if(r==="legal"){W(n);var t=c==null?void 0:c.legalBasis.find(function(u){return u.id===n});t&&Le(t)}},We=function(){if(!c||!c.contractText)return g?(0,e.jsx)("pre",{className:"whitespace-pre-wrap",children:g}):(0,e.jsx)("div",{className:"text-gray-400 text-center py-10",children:"\u6682\u65E0\u5408\u540C\u6587\u672C\u5185\u5BB9"});var r=c.contractText,n=c.risks,s=c.suggestions,a=c.legalBasis,t=[];n.forEach(function(l){t.push({range:l.highlightRange,type:"risk",id:l.id})}),s.forEach(function(l){t.push({range:l.highlightRange,type:"suggestion",id:l.id})}),a.forEach(function(l){t.push({range:l.relatedRange,type:"legal",id:l.id})}),t.sort(function(l,w){return l.range.start-w.range.start});var u=[],h=0;return t.forEach(function(l,w){l.range.start<h||l.range.end>r.length||(l.range.start>h&&u.push((0,e.jsx)("span",{children:r.substring(h,l.range.start)},"text-".concat(w))),u.push((0,e.jsx)("mark",{className:"highlight ".concat(l.type," ").concat(be===l.id?"active":""),id:l.id,onClick:function(){return Ge(l.type,l.id)},children:r.substring(l.range.start,l.range.end)},"highlight-".concat(l.id))),h=l.range.end)}),h<r.length&&u.push((0,e.jsx)("span",{children:r.substring(h)},"text-end")),u},Ve=function(){if(!O)return null;if(P==="risk"){var r,n=O,s=(r=n.legalBasis)!==null&&r!==void 0?r:[],a=s.length>0;return(0,e.jsxs)("div",{className:"detail-modal",children:[(0,e.jsxs)("div",{className:"modal-section",children:[(0,e.jsx)("div",{className:"section-label",children:"\u98CE\u9669\u7B49\u7EA7"}),(0,e.jsx)(ee.Z,{color:n.level==="high"?"red":n.level==="medium"?"orange":"green",children:n.level==="high"?"\u9AD8\u98CE\u9669":n.level==="medium"?"\u4E2D\u98CE\u9669":"\u4F4E\u98CE\u9669"})]}),(0,e.jsxs)("div",{className:"modal-section",children:[(0,e.jsx)("div",{className:"section-label",children:"\u98CE\u9669\u63CF\u8FF0"}),(0,e.jsx)("div",{className:"section-content",children:n.content})]}),n.suggestion&&(0,e.jsxs)("div",{className:"modal-section",children:[(0,e.jsx)("div",{className:"section-label",children:"\u5EFA\u8BAE\u63AA\u65BD"}),(0,e.jsx)("div",{className:"section-content",children:n.suggestion})]}),a&&(0,e.jsxs)("div",{className:"modal-section",children:[(0,e.jsx)("div",{className:"section-label",children:"\u76F8\u5173\u6CD5\u5F8B\u4F9D\u636E"}),(0,e.jsx)("div",{className:"section-content",children:s.map(function(h){return(0,e.jsxs)("div",{style:{marginBottom:8},children:[(0,e.jsxs)("div",{style:{fontWeight:600},children:[h.lawName," ",h.article]}),(0,e.jsx)("div",{style:{margin:"6px 0",fontSize:12,color:"#666"},children:h.content}),(0,e.jsxs)("div",{className:"legal-score",children:[(0,e.jsx)(J.Z,{disabled:!0,allowHalf:!0,value:h.score*5,style:{fontSize:12}}),(0,e.jsxs)("span",{style:{marginLeft:8,fontSize:12},children:["\u76F8\u5173\u5EA6: ",(h.score*100).toFixed(0),"%"]})]})]},h.id)})})]})]})}if(P==="suggestion"){var t=O;return(0,e.jsxs)("div",{className:"detail-modal",children:[(0,e.jsxs)("div",{className:"diff-display",children:[(0,e.jsxs)("div",{className:"diff-row",children:[(0,e.jsx)("div",{className:"diff-label",children:"\u539F\u6587"}),(0,e.jsx)("div",{className:"diff-content original",children:t.original})]}),(0,e.jsxs)("div",{className:"diff-row",children:[(0,e.jsx)("div",{className:"diff-label",children:"\u4FEE\u6539\u4E3A"}),(0,e.jsx)("div",{className:"diff-content revised",children:t.revised})]})]}),t.reason&&(0,e.jsxs)("div",{className:"modal-section",children:[(0,e.jsx)("div",{className:"section-label",children:"\u4FEE\u6539\u7406\u7531"}),(0,e.jsx)("div",{className:"section-content",children:t.reason})]})]})}if(P==="legal"){var u=O;return(0,e.jsxs)("div",{className:"detail-modal",children:[(0,e.jsxs)("div",{className:"modal-section",children:[(0,e.jsx)("div",{className:"section-label",children:"\u6CD5\u5F8B\u540D\u79F0"}),(0,e.jsx)("div",{className:"section-content",children:u.lawName})]}),(0,e.jsxs)("div",{className:"modal-section",children:[(0,e.jsx)("div",{className:"section-label",children:"\u6761\u6B3E"}),(0,e.jsx)("div",{className:"section-content",children:u.article})]}),(0,e.jsxs)("div",{className:"modal-section",children:[(0,e.jsx)("div",{className:"section-label",children:"\u6CD5\u6761\u5185\u5BB9"}),(0,e.jsx)("div",{className:"section-content",children:u.content})]}),(0,e.jsxs)("div",{className:"modal-section",children:[(0,e.jsx)("div",{className:"section-label",children:"\u76F8\u5173\u5EA6\u8BC4\u5206"}),(0,e.jsxs)("div",{className:"legal-score",children:[(0,e.jsx)(J.Z,{disabled:!0,allowHalf:!0,value:u.score*5}),(0,e.jsxs)("span",{style:{marginLeft:8},children:[(u.score*100).toFixed(0),"%"]})]})]}),u.explanation&&(0,e.jsxs)("div",{className:"modal-section",children:[(0,e.jsx)("div",{className:"section-label",children:"\u9002\u7528\u8BF4\u660E"}),(0,e.jsx)("div",{className:"section-content",children:u.explanation})]})]})}},Oe=function(){return P==="risk"?"\u98CE\u9669\u8BE6\u60C5":P==="suggestion"?"\u4FEE\u6539\u5EFA\u8BAE\u8BE6\u60C5":"\u6CD5\u5F8B\u4F9D\u636E\u8BE6\u60C5"};return B?(0,e.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-slate-50 to-white flex items-center justify-center px-4",children:(0,e.jsxs)("div",{className:"w-full max-w-md rounded-2xl bg-white border border-slate-100 shadow-xl px-8 py-10 text-center space-y-4",children:[(0,e.jsx)("div",{className:"bg-gradient-to-r from-brand-600 to-blue-500 inline-flex items-center justify-center rounded-full px-4 py-1 text-xs font-medium text-white",children:R==="analyzing"?"\u5408\u540C\u667A\u80FD\u5206\u6790\u8FDB\u884C\u4E2D\u2026":"\u6B63\u5728\u51C6\u5907\u5206\u6790..."}),(0,e.jsx)("p",{className:"text-sm text-slate-500",children:"\u6211\u4EEC\u6B63\u5728\u4E3A\u60A8\u89E3\u6790\u5408\u540C\u6761\u6B3E\u5E76\u751F\u6210\u98CE\u9669\u63D0\u793A\u3001\u4FEE\u6539\u610F\u89C1\u4E0E\u6CD5\u5F8B\u4F9D\u636E\uFF0C\u8BF7\u7A0D\u5019\u3002"}),(0,e.jsx)("div",{className:"flex justify-center pt-2",children:(0,e.jsx)(me.Z,{size:"large",tip:R==="analyzing"?"\u6B63\u5728\u5206\u6790\u5408\u540C...":"\u6B63\u5728\u52A0\u8F7D..."})})]})}):(0,e.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-slate-50 to-white px-4 py-6",children:(0,e.jsxs)("div",{className:"mx-auto max-w-6xl rounded-2xl bg-white border border-slate-100 shadow-xl overflow-hidden",children:[(0,e.jsxs)("div",{className:"bg-gradient-to-r from-brand-600 to-blue-500 px-6 py-4 flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-xs font-semibold tracking-wide text-brand-50/80 uppercase",children:"LegalRag"}),(0,e.jsx)("p",{className:"text-sm text-brand-50",children:"\u5408\u540C\u5206\u6790\u7ED3\u679C"})]}),(0,e.jsx)("span",{className:"rounded-full border border-white/30 bg-white/10 px-3 py-1 text-xs text-brand-50",children:"\u98CE\u9669\u63D0\u793A \xB7 \u4FEE\u6539\u610F\u89C1 \xB7 \u6CD5\u5F8B\u4F9D\u636E"})]}),(0,e.jsx)("div",{className:"contract-analysis px-4 pb-4 pt-2",children:(0,e.jsxs)(ve._z,{header:{title:"\u5408\u540C\u5206\u6790\u7ED3\u679C",onBack:$e,extra:[(0,e.jsx)(ge.ZP,{onClick:Me,children:"\u91CD\u65B0\u5206\u6790"},"reanalyze")]},children:[c&&(0,e.jsx)("div",{className:"analysis-content",children:(0,e.jsxs)(pe.Z,{gutter:24,children:[(0,e.jsx)(se.Z,{span:12,children:(0,e.jsx)(F.Z,{title:"\u5408\u540C\u6587\u672C",bordered:!1,children:(0,e.jsx)("div",{className:"contract-text-panel",ref:De,children:We()})})}),(0,e.jsx)(se.Z,{span:12,children:(0,e.jsx)("div",{className:"analysis-panel",children:(0,e.jsx)(F.Z,{title:"\u98CE\u9669\u8BE6\u60C5",bordered:!1,style:{marginBottom:16},bodyStyle:{padding:"20px"},children:j?(0,e.jsxs)("div",{className:"detail-container",children:[(0,e.jsxs)("div",{className:"modal-section",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[(0,e.jsx)("span",{style:{fontSize:16,fontWeight:600},children:"\u98CE\u9669\u7B49\u7EA7"}),(0,e.jsx)(ee.Z,{color:j.level==="high"?"#f5222d":j.level==="medium"?"#fa8c16":"#52c41a",style:{padding:"4px 16px",fontSize:14,borderRadius:12,marginRight:0},children:j.level==="high"?"\u9AD8\u98CE\u9669":j.level==="medium"?"\u4E2D\u98CE\u9669":"\u4F4E\u98CE\u9669"})]}),(0,e.jsx)(F.Z,{type:"inner",title:(0,e.jsx)("span",{style:{color:"#cf1322"},children:"\u{1F6A8} \u98CE\u9669\u63CF\u8FF0"}),size:"small",style:{marginBottom:16,backgroundColor:"#fff1f0",borderColor:"#ffa39e"},children:(0,e.jsx)("div",{style:{lineHeight:"1.6",color:"#333"},children:j.detected_issue})}),j.suggestions&&(0,e.jsx)(F.Z,{type:"inner",title:(0,e.jsx)("span",{style:{color:"#d48806"},children:"\u{1F4A1} \u5EFA\u8BAE\u63AA\u65BD"}),size:"small",style:{marginBottom:16,backgroundColor:"#feffe6",borderColor:"#fffb8f"},children:(0,e.jsx)("div",{style:{lineHeight:"1.6",color:"#333"},children:j.suggestions})}),j.legal_basis&&j.legal_basis.length>0&&(0,e.jsxs)("div",{className:"modal-section",children:[(0,e.jsx)("div",{className:"section-title",style:{fontSize:15,fontWeight:600,marginBottom:12,marginTop:24},children:"\u2696\uFE0F \u76F8\u5173\u6CD5\u5F8B\u4F9D\u636E"}),(0,e.jsx)("div",{className:"section-content",children:j.legal_basis.map(function(i,r){return(0,e.jsxs)(F.Z,{size:"small",hoverable:!0,className:"legal-card",style:{marginBottom:12,borderRadius:6,borderLeft:"4px solid #1890ff"},children:[(0,e.jsxs)("div",{style:{fontWeight:600,color:"#262626",marginBottom:4},children:[i.law_name," ",i.order]}),(0,e.jsx)("div",{style:{fontSize:13,color:"#666",marginBottom:8,lineHeight:"1.5"},children:i.content}),(0,e.jsxs)("div",{className:"legal-score",style:{display:"flex",alignItems:"center"},children:[(0,e.jsx)(J.Z,{disabled:!0,allowHalf:!0,value:(i.relevance_score||0)*5,style:{fontSize:12}}),(0,e.jsxs)("span",{style:{marginLeft:8,fontSize:12,color:"#8c8c8c"},children:["\u76F8\u5173\u5EA6:"," ",((i.relevance_score||0)*100).toFixed(0),"%"]})]})]},r)})})]})]}):(0,e.jsxs)("div",{className:"text-gray-400 text-center py-12",children:[(0,e.jsx)("div",{style:{fontSize:40,marginBottom:16},children:"\u{1F4CB}"}),(0,e.jsx)("div",{children:"\u6682\u65E0\u98CE\u9669\u8BE6\u60C5"}),(0,e.jsx)("div",{style:{fontSize:12,marginTop:8},children:"\u70B9\u51FB\u5DE6\u4FA7\u5408\u540C\u5185\u5BB9\u7684\u6807\u8BB0\u5904\u67E5\u770B"})]})})})})]})}),(0,e.jsx)(je.Z,{title:Oe(),open:Be,onCancel:function(){return V(!1)},footer:null,width:700,children:Ve()})]})})]})})},Ne=ye}}]);
